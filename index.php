<?php
require_once $_SERVER['DOCUMENT_ROOT'].'/3severside/resetSession.php';
session_start();
if (!isset($_SESSION['hasSignedIn'])) {
    echo "resetting session";
    reset_session();
    header("Refresh:0 ");
    exit;
}

$parameter      = $_GET['target'] ?? null;
$searchQuery    = $_GET['search'] ?? null;
$categoryQuery  = $_GET['category'] ?? null;
$tabQuery       = $_GET['tab'] ?? null;
$target         = 'landing.html';

switch ($parameter) {
  case "signin":     $target = "signin.php"; break;
  case "signup":     $target = "signup.php"; break;
  case "signout":    $target = "signout.php"; break;
  case "search":     $target = "search.php?" . ($searchQuery ? "search=" . urlencode($searchQuery) : "") . ($searchQuery && $categoryQuery ? "&" : "") . ($categoryQuery ? "category=" . urlencode($categoryQuery) : ""); break;
  case "mypage":     $target = "mypage.php"; break;
  case "cart":       $target = "cart.php"; break;
  case "categories": $target = "category.php"; break;
  case "dashboard":  $target = "dashboard.php" . ($tabQuery ? "?tab=" . urlencode($tabQuery) : "") ; break;
  default:           $target = "landing.html";
}
error_log("Loading target: " . $target);
?>

<!-- 
    !! FOR ANY DEVELOPERS AND SORCERERS WORKING ON THIS MAGICAL ONLINE SHOPPINGMALL !!

    I love the wizarding world based on harry potter series.
    "Merlin" is the legenday wizard, so that I used his name as the master administor
    Password? Alohomora. Just kiddin'. "passwd" it is.

    go to /admin/ then index.php in DOCUMENT_ROOT/admin/index.php will greet you
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="description" content="Greetings toward the potential red team leaders!" />
    <meta charset="utf-8">
    <title>5T4R mall</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/0style/mainw3.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #0e1a40; color: #ffffff; }
        .topnav { background-color: #2a4a75; overflow: hidden; }
        .topnav a { float: left; display: block; color: #ffffff; text-align: center; padding: 14px 16px; text-decoration: none; }
        .topnav a:hover { background-color: #1a2e4c; }
        .search-container input[type=text] { padding: 8px; margin-top: 8px; font-size: 16px; border: none; background-color: #f0f5f9; color: #333; }
        .search-container button { padding: 8px 12px; margin-top: 8px; margin-right: 16px; background: #a7845d; font-size: 16px; border: none; cursor: pointer; color: #ffffff; }
        .search-container button:hover { background: #725829; }
        .container { padding: 20px; text-align: center; }
        .footer { background-color: #f2f2f2; padding: 20px; text-align: center; color: #333; }
    </style>
</head>
<body>
    <table width="100%" border="0" cellpadding="0" align="center" style="border-collapse: collapse; border:1px">
        <tr> <!-- top bar goes here -->
            <td colspan="2" style="border-collapse: collapse; border:1px solid black">
                <div class="topnav">
                    <a class="active" href="./">🏰</a>
                    <a href="/?target=categories">Browse📜</a>
                    <!--<a href="/?target=test">Test</a>-->
                    <?php
                    // Check if the user is signed in
                    if (isset($_SESSION['hasSignedIn']) && $_SESSION['hasSignedIn']) {
                        if ($_SESSION['usertype'] == "Customer") {
                            echo "<div><a href='/?target=mypage'>My🧑🏻‍💻👩🏻‍💻</a> <div><a href='/?target=cart'>🛒</a> ";  
                        } else if ($_SESSION['usertype'] == "Employee") {
                            echo "<div><a href='/?target=dashboard'>Dashboard📊</a>";
                        } else {
                            header("Location: /errrrror.html"); exit;
                        }
                        echo "<a href='/?target=signout'>Leave🫥</a> <a>Greetings👋, " . $_SESSION['username'] .  "!</a></div>";
                    } else {?>
                        <div><a href='/?target=signin'>Sign In👈🏻 & Up🆙</a></div>
                    <?php } ?>

                    <div><a>Homes of Fellow Sorcerer🧙🏻‍♀️s'</a></div>
                    <div><a href='http://3.34.182.173'>지원🏠</a></div>
                    <div><a href='http://3.34.141.120'>정현🏠</a></div>
                    
                    <div class="search-container">
                        
                        <form action="/" method="get">
                            🔎
                            <input type="text" placeholder="Revelio.." name="search">
                            <input type="hidden" name="target" value="search">
                            <button type="submit"><i class="fa fa-search"></i></button>
                        </form>
                    </div>
                </div>
            </td>
        </tr>
        <!-- <tr>   Second top bar for debugging goes here 
            <?php echo $_SESSION['userid']?> | <?php echo $_SESSION['username']?></br>
            <?php echo $_SESSION['usertype']?> | <?php echo $_SESSION['acl']?> | <?php echo $_SESSION['hasSignedIn']?></br> 
        </tr>-->
        <tr>
            <td colspan="2" style="height:auto; overflow:auto; border-collapse:collapse; border:1px solid black" id="mainscreen">
                <iframe src="/1internals/<?php echo $target; ?>" height="1500vh" width="100%" frameborder="0" ></iframe>
            </td>
            <!-- contents goes here -->
        </tr>
        <tr> <!-- mr shortbottom goes here -->
            <td style="border-collapse: collapse; border:1px solid black">      
                KISIA PENETRATION TEST WEBPAGE </br>
                All lefts reserved. (C) copyleft</br>
                =======================================================================================================================</br>
                </br>
                The owner / founder, Franciskus Yoo, is a Hogwash graduate,</br>
                Transfered from Ilvermorny School of Witchcraft and Wizardry in 'Merica.</br>
                </br>
                As from [ Horned Serpent ] and [ Ravenclaw ] houses, this guy loves the knowledge and wit.</br>
                (The sorting hat tried to put me in Griffindor, but managed to tap into it's sorting algorithm and diverted to the desired house. LOL.)</br>
                </br>
                As an Adjunct professor of Muggle's Engineering in Hogwash and a succesful business wizard,</br>
                I assure you to offer the finest products available in U.K. and Europe.</br>
                <img src="/2assets/bgr/Ravenclaw-Symbol.png" width=500>
                <img src="/2assets/bgr/Horned_Serpent_ClearBG_2.png" width=250></br>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                UK: Ravenclaw, Hogwash
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                US: Horned Serpent, Ilvermorny
            </td>
        </tr>
    </table>
</body>
</html>
