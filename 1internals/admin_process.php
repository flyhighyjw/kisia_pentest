<?php
    // resetting session is already handled in admin.php
    session_start();
    require_once $_SERVER['DOCUMENT_ROOT'] . '/3severside/database.php';

    // Check if form is submitted correctly
    if ($_SERVER["REQUEST_METHOD"] != "POST") { header("Location: /errrrror.html"); exit; }

    // Get username and password from form
    $username = $_POST['username'];
    $password = $_POST['password'];

    // SQL query to fetch admin details based on username
    $sql    = "SELECT * FROM Employees WHERE eid = '$username' AND epw = '$password'";
    $result = execute_query($sql);

    // Check if username exists
    if (!$result->num_rows > 0) { header("Location: /admin.php?error=invalid_credentials"); exit; }

    // Fetch user details
    $row = $result->fetch_assoc();
    //$db_password = $row['epw'];

    // Verify password
    //if (password_verify($password, $db_password)) { //hashed pw
    //if ($password === $db_password) { //comparing string like a simpleton
        // Password is correct, set session variables
        $_SESSION["userid"]      = $row['eid'];
        $_SESSION["username"]    = $row['ename'];
        $_SESSION["usertype"]    = 'Employee';
        $_SESSION["acl"]    = $row['eacl'];
        $_SESSION["hasSignedIn"] = true;

        // Redirect to admin panel or dashboard
        header("Location: /");
        exit;
        /*
    } else {
        // Invalid password, redirect back to sign-in page with error
        header("Location: /admin/?error=invalid_credentials");
        exit;
    }*/
  ?>