<?php
    require_once $_SERVER['DOCUMENT_ROOT'].'/3severside/database.php';
    session_start();
    
    if ($_SESSION['usertype'] != 'Employee') {
        require_once $_SERVER['DOCUMENT_ROOT'].'/3severside/resetSession.php';
        reset_session();
        header("Location: /1internals/"); // Redirect to sign-in page if not logged in
        exit;
    }
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .tab { overflow: hidden; background-color: #0E1A40; }
        .tab button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; color: #FFFFFF; }
        .tab button:hover { background-color: #222F66; }
        .tab button.active { background-color: #222F66; }
        .tabcontent { display: none; padding: 6px 12px; border: 1px solid #222F66; border-top: none; background-color: #FFFFFF; }
        h3, p { color: #222F66; }
        .item-table-container { margin-top: 20px; }
        .item-table { width: 100%; border-collapse: collapse; }
        .item-table th, .item-table td { border: 1px solid #222F66; padding: 8px; text-align: left; }
        .item-table th { background-color: #0E1A40; color: #FFFFFF; }
        .edit-btn, .delete-btn, .disable-btn, .enable-btn, .add-item-btn { padding: 5px 10px; margin-right: 5px; border: none; cursor: pointer; border-radius: 3px; }
        .edit-btn { background-color: #5C8D89; color: white; }
        .delete-btn { background-color: #C93E4F; color: white; }
        .disable-btn, .enable-btn { background-color: #185A9D; color: white; }
        .add-item-btn { margin-top: 20px; background-color: #5C8D89; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 3px; }
        .iframe-container { height: 1320px; background-color: #222F66; }
    </style>
</head>

<body>

    <div class="tab">
        <button id="dashboardBtn"           class="tablinks" onclick="openTab(event, 'dashboard')">Dashboard Home</button>
        <button id="mypageBtn"              class="tablinks" onclick="openTab(event, 'mypage')">MyAdmin</button>
        <button id="ordersBtn"              class="tablinks" onclick="openTab(event, 'orders')">Order</button>
        <button id="itemBtn"                class="tablinks" onclick="openTab(event, 'item')">Item</button>
        <button id="item_descriptionBtn"    class="tablinks" onclick="openTab(event, 'item_description')">Description</button>
        <button id="qnaBtn"                 class="tablinks" onclick="openTab(event, 'qna')">QnA</button>
        <button id="reviewBtn"              class="tablinks" onclick="openTab(event, 'review')">Review</button>
    </div>

    <!-- Tab content -->
    <div class="tabcontent iframe-container" id="dashboard">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="mypage">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="orders">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="item">
        <iframe src="" frameborder="0" width="100%" height="1300vh"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="item_description">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="qna">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <div class="tabcontent iframe-container" id="review">
        <iframe src="" frameborder="0" width="100%" height="100%"></iframe>
    </div>

    <script>
        function openTab(evt, tabName) {
            var newURL = '/?target=dashboard&tab=' + tabName;
            // Update the parent window's URL
            window.parent.history.pushState({}, '', newURL);

            // Hide all tab content
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Deactivate all tab links
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the selected tab content and set the active tab link
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active"; 

            // Set the iframe source based on the selected tab
            var iframe = document.querySelector('#' + tabName + ' iframe');
            switch (tabName) {
                case 'dashboard':
                    iframe.src = 'admin/dash_home.php';
                    break;
                case 'mypage':
                    iframe.src = 'admin/myadmin.php';
                    break;
                case 'orders':
                    iframe.src = 'admin/order_management.php';
                    break;
                case 'item':
                    iframe.src = 'admin/item_management.php';
                    break;
                case 'item_description':
                    iframe.src = 'admin/descr_management.php';
                    break;
                case 'qna':
                    iframe.src = 'admin/qna_management.php';
                    break;
                case 'review':
                    iframe.src = 'admin/review_management.php';
                    break;
            }
        }

        // Trigger click event on the tab specified in the GET parameter
        window.onload = function() {
            var urlParams = new URLSearchParams(window.location.search);
            var tab = urlParams.get('tab');
            if (tab) {
                document.getElementById(tab + 'Btn').click();
            } else {
                document.getElementById('dashboardBtn').click(); // Default to Dashboard if no tab parameter is found
            }
        };
    </script>
</body>
</html>
