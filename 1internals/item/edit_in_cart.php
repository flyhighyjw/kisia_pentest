<?php
// Check if the form is submitted
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Include the database connection file
    require_once $_SERVER['DOCUMENT_ROOT'] . '/3severside/database.php';
    session_start();

    // Check if the user is signed in
    if (!isset($_SESSION['hasSignedIn']) || !$_SESSION['hasSignedIn']) {
        // Redirect to sign-in page
        header("Location: /1internals/signin.php");
        exit;
    }

    // Check if edit_dno and edit_amount are set and are valid integers
    if (isset($_POST['edit_dno']) && filter_var($_POST['edit_dno'], FILTER_VALIDATE_INT) &&
        isset($_POST['edit_amount']) && filter_var($_POST['edit_amount'], FILTER_VALIDATE_INT)) {
        $edit_dno = $_POST['edit_dno'];
        $edit_amount = $_POST['edit_amount'];

        // Fetch uno from Users table using uid
        $userid = $_SESSION['userid'];
        $userQuery = "SELECT uno FROM Users WHERE uid = '$userid'";
        $userResult = execute_query($userQuery);
        $userRow = $userResult->fetch_assoc();
        $uno = $userRow['uno'];

        // Update the camo in the Carts table
        $updateQuery = "UPDATE Carts SET camo = '$edit_amount' WHERE dno = '$edit_dno' AND uno = '$uno'";
        $result = execute_query($updateQuery);

        // Check if update was successful
        if ($result) {
            // Redirect back to the cart page
            header("Location: /1internals/cart.php");
            exit;
        } else {
            // Handle error if update failed
            echo "Error: Unable to update item in cart.";
            // You can redirect or display a message as per your requirement
        }
    } else {
        // Handle invalid input for edit_dno or edit_amount
        echo "Error: Invalid input for edit_dno or edit_amount.";
        // You can redirect or display a message as per your requirement
    }
} else {
    // Handle if the form is not submitted
    echo "Error: Form not submitted.";
    // You can redirect or display a message as per your requirement
}
?>
