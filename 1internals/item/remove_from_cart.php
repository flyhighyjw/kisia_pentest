<?php
// Check if the form is submitted
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Include the database connection file
    require_once $_SERVER['DOCUMENT_ROOT'] . '/3severside/database.php';
    session_start();

    // Check if the user is signed in
    if (!isset($_SESSION['hasSignedIn']) || !$_SESSION['hasSignedIn']) {
        // Redirect to sign-in page
        header("Location: /1internals/signin.php");
        exit;
    }

    // Check if remove_cno is set and is a valid integer
    if (isset($_POST['remove_cno']) && filter_var($_POST['remove_cno'], FILTER_VALIDATE_INT)) {
        $remove_cno = $_POST['remove_cno'];

        // Fetch uno from Users table using uid
        $userid = $_SESSION['userid'];
        $userQuery = "SELECT uno FROM Users WHERE uid = '$userid'";
        $userResult = execute_query($userQuery);
        $userRow = $userResult->fetch_assoc();
        $uno = $userRow['uno'];

        // Delete the row from the Carts table
        $deleteQuery = "DELETE FROM Carts WHERE cno = '$remove_cno' AND uno = '$uno'";
        $result = execute_query($deleteQuery);

        // Check if deletion was successful
        if ($result) {
            // Redirect back to the cart page
            header("Location: /1internals/cart.php");
            exit;
        } else {
            // Handle error if deletion failed
            echo "Error: Unable to remove item from cart.";
            // You can redirect or display a message as per your requirement
        }
    } else {
        // Handle invalid input for remove_cno
        echo "Error: Invalid input for remove_cno.";
        // You can redirect or display a message as per your requirement
    }
} else {
    // Handle if the form is not submitted
    echo "Error: Form not submitted.";
    // You can redirect or display a message as per your requirement
}
?>
