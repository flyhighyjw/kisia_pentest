<?php
require_once $_SERVER['DOCUMENT_ROOT'] . '/3severside/database.php';
session_start();

// Check if user is logged in
if (!isset($_SESSION['userid'])) { // If not, then it means something went wrong.
    require_once $_SERVER['DOCUMENT_ROOT'].'/3severside/resetSession.php';
    reset_session();
    header("Location: /errrrror.html");
    exit;
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $ename      = $_POST['ename'];
    $eid        = $_SESSION['userid'];
    $epw        = $_POST['epw'];
    $epw_cfrm   = $_POST['epw_cfrm'];
    $emono      = $_POST['emono'];

    if (empty($ename) || empty($eid) || empty($epw) || empty($epw_cfrm) || empty($emono)) {
        $error_message = "All fields are required! >=(";
        header("Location: myadmin.php?tab=info&error=" . urlencode($error_message));
        exit;
    } else if ($epw !== $epw_cfrm) {
        $error_message = "Passwords do not match Brother!!";
        header("Location: myadmin.php?tab=info&error=" . urlencode($error_message));
        exit;
    }
    
    $result = execute_query("SELECT eno FROM Employees WHERE eid = '$eid'");
    if ($result->num_rows > 0) {
        $user = $result->fetch_assoc();
        $eno = $user['eno'];

        $result = execute_query("UPDATE Employees SET ename='$ename', eid='$eid', epw='$epw', emono='$emono' WHERE eno=$eno");

        $success_message = "Information updated successfully!";
        header("Location: myadmin.php?tab=info&success=" . urlencode($success_message));
    } else {
        $error_message = "Employee not found. WTF???";
        header("Location: myadmin.php?tab=info&error=" . urlencode($error_message));
    }       
}
?>
